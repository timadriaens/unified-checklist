# Get related information

In this chapter we retrieve related information for taxa on the checklists (with a valid distribution).

## Read data

Read data from [`data/raw/taxa.csv`](https://github.com/trias-project/unified-checklist/blob/master/data/raw/taxa.csv).

```{r}
taxa <- read_csv(here("data", "raw", "taxa.csv"))
```

## Filter checklist taxa

1. Filter on taxa with valid distribution. **Note**: if a checklist has related information for a taxon, but not a valid distribution, that related information will NOT be included in the unified checklist. This is to exclude related information about a taxon for which the checklist did not even consider a Belgian scope (e.g. pathway).

```{r}
taxon_keys <- taxa %>%
  filter(validDistribution) %>%
  pull(taxonKey)
```

## Get distributions

1. Get distributions for our taxa from GBIF.

```{r get_information-get_distributions_from_gbif, cache = TRUE}
progress_bar <- progress_estimated(length(taxon_keys))

distributions <- map_dfr(taxon_keys, function(x) {
  progress_bar$tick()$print()
  rgbif::name_usage(
    key = x,
    return = "data",
    data = "distribution"
  )
})
```

2. Save to [CSV](https://github.com/trias-project/unified-checklist/blob/master/data/raw/distributions.csv).

```{r}
write_csv(distributions, here("data", "raw", "distributions.csv"), na = "")
```

## Get species profiles

1. Get species profiles for our taxa from GBIF.

```{r get_information-get_speciesprofiles_from_gbif, cache = TRUE}
progress_bar <- progress_estimated(length(taxon_keys))

speciesprofiles <- map_dfr(taxon_keys, function(x) {
  progress_bar$tick()$print()
  rgbif::name_usage(
    key = x,
    return = "data",
    data = "speciesProfiles"
  )
})
```

2. Save to [CSV](https://github.com/trias-project/unified-checklist/blob/master/data/raw/speciesprofiles.csv).

```{r}
write_csv(speciesprofiles, here("data", "raw", "speciesprofiles.csv"), na = "")
```

## Get descriptions

1. Get descriptions for our taxa from GBIF.

```{r get_information-get_descriptions_from_gbif, cache = TRUE}
progress_bar <- progress_estimated(length(taxon_keys))

descriptions <- map_dfr(taxon_keys, function(x) {
  progress_bar$tick()$print()
  rgbif::name_usage(
    key = x,
    return = "data",
    data = "description"
  )
})
```

2. Save to [CSV](https://github.com/trias-project/unified-checklist/blob/master/data/raw/descriptions.csv).

```{r}
write_csv(descriptions, here("data", "raw", "descriptions.csv"), na = "")
```
